<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="xiangyu fu">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="https://xiangyu-fu.github.io/2024/09/10/reviews/esp32_udp/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="Introduction In this tutorial, I will walk through using UDP and mDNS with the ESP32 platform. I&#39;ll cover how to set up UDP communication between an ESP32 and a client device, along with using mDNS">
<meta property="og:type" content="article">
<meta property="og:title" content="How to use UDP and mDNS on ESP32">
<meta property="og:url" content="https://xiangyu-fu.github.io/2024/09/10/Reviews/esp32_udp/index.html">
<meta property="og:site_name" content="Xiangyu Fu&#39;s Blog">
<meta property="og:description" content="Introduction In this tutorial, I will walk through using UDP and mDNS with the ESP32 platform. I&#39;ll cover how to set up UDP communication between an ESP32 and a client device, along with using mDNS">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-09-10T18:53:47.000Z">
<meta property="article:modified_time" content="2024-09-10T18:55:34.978Z">
<meta property="article:author" content="Xiangyu Fu">
<meta property="article:tag" content="en-US">
<meta property="article:tag" content="ESP32">
<meta property="article:tag" content="UDP">
<meta property="article:tag" content="mDNS">
<meta name="twitter:card" content="summary">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/giphy.gif" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/giphy.gif">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/images/giphy.gif">
    <!--- Page Info-->
    
    <title>
        
            How to use UDP and mDNS on ESP32 -
        
        xiangyu fu&#39;s blog
    </title>

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">


    <!--- Inject Part-->
    

    
        <style>
    :root {
        --preloader-background-color: #fff;
        --preloader-text-color: #000;
    }

    @media (prefers-color-scheme: dark) {
        :root {
            --preloader-background-color: #202124;
            --preloader-text-color: #fff;
        }
    }

    @media (prefers-color-scheme: light) {
        :root {
            --preloader-background-color: #fff;
            --preloader-text-color: #000;
        }
    }

    @media (max-width: 600px) {
        .ml13 {
            font-size: 2.6rem !important; /* Adjust this value as needed */
        }
    }

    .preloader {
        display: flex;
        flex-direction: column;
        gap: 1rem; /* Tailwind 'gap-4' is 1rem */
        align-items: center;
        justify-content: center;
        position: fixed;
        padding: 12px;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        width: 100vw;
        height: 100vh; /* 'h-screen' is 100% of the viewport height */
        background-color: var(--preloader-background-color);
        z-index: 1100; /* 'z-[1100]' sets the z-index */
        transition: opacity 0.2s ease-in-out;
    }

    .ml13 {
        font-size: 3.2rem;
        /* text-transform: uppercase; */
        color: var(--preloader-text-color);
        letter-spacing: -1px;
        font-weight: 500;
        font-family: 'Chillax-Variable', sans-serif;
        text-align: center;
    }

    .ml13 .word {
        display: inline-flex;
        flex-wrap: wrap;
        white-space: nowrap;
    }

    .ml13 .letter {
        display: inline-block;
        line-height: 1em;
    }
</style>

<div class="preloader">
    
<script src="/js/libs/anime.min.js"></script>

    <h1 class="ml13">
        xiangyu fu&#39;s blog
    </h1>
    <script>
        var textWrapper = document.querySelector('.ml13');
        // Split text into words
        var words = textWrapper.textContent.trim().split(' ');

        // Clear the existing content
        textWrapper.innerHTML = '';

        // Wrap each word and its letters in spans
        words.forEach(function(word) {
            var wordSpan = document.createElement('span');
            wordSpan.classList.add('word');
            wordSpan.innerHTML = word.replace(/\S/g, "<span class='letter'>$&</span>");
            textWrapper.appendChild(wordSpan);
            textWrapper.appendChild(document.createTextNode(' ')); // Add space between words
        });


        anime.timeline({loop: true})
            .add({
                targets: '.ml13 .letter',
                translateY: [100,0],
                translateZ: 0,
                opacity: [0,1],
                easing: "easeOutExpo",
                duration: 1400,
                delay: (el, i) => 300 + 30 * i
            }).add({
            targets: '.ml13 .letter',
            translateY: [0,-100],
            opacity: [1,0],
            easing: "easeInExpo",
            duration: 1200,
            delay: (el, i) => 100 + 30 * i
        });

        let themeStatus = JSON.parse(localStorage.getItem('REDEFINE-THEME-STATUS'))?.isDark;

        // If the theme status is not found in local storage, check the preferred color scheme
        if (themeStatus === undefined || themeStatus === null) {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                themeStatus = 'dark';
            } else {
                themeStatus = 'light';
            }
        }

        // Now you can use the themeStatus variable in your code
        if (themeStatus) {
            document.documentElement.style.setProperty('--preloader-background-color', '#202124');
            document.documentElement.style.setProperty('--preloader-text-color', '#fff');
        } else {
            document.documentElement.style.setProperty('--preloader-background-color', '#fff');
            document.documentElement.style.setProperty('--preloader-text-color', '#000');
        }

        window.addEventListener('load', function () {
            hidePreloaderAfterTimeout(1000); // Hide after 1000 milliseconds once the window has loaded
        });

        // Backup failsafe: Hide preloader after a maximum of 5000 milliseconds, regardless of the window load event
        hidePreloaderAfterTimeout(5000);

        function hidePreloaderAfterTimeout(delay) {
            setTimeout(function () {
                var preloader = document.querySelector('.preloader');
                preloader.style.opacity = '0';
                setTimeout(function () {
                    preloader.style.display = 'none';
                }, 200);
            }, delay);
        }
    </script>
</div>
    

    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/assets/build/styles.css">

    

    
<link rel="stylesheet" href="/fonts/fonts.css">

    
<link rel="stylesheet" href="/fonts/Satoshi/satoshi.css">

    <!--- Font Part-->
    
    
    
        <link href="https://cdnjs.cloudflare.com/ajax/libs/lxgw-wenkai-screen-webfont/1.7.0/lxgwwenkaiscreenr.css" rel="stylesheet">
    
    
        <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
    


    <script id="hexo-configurations">
    window.config = {"hostname":"xiangyu-fu.github.io","root":"/","language":"en","path":"search.xml"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"title_alignment":"left","headings_top_spacing":{"h1":"5rem","h2":"4rem","h3":"2.8rem","h4":"2.5rem","h5":"2.2rem","h6":"2rem"}},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null,"default_mode":"dark"},"global":{"fonts":{"chinese":{"enable":true,"family":"LXGW WenKai Screen R","url":"https://cdnjs.cloudflare.com/ajax/libs/lxgw-wenkai-screen-webfont/1.7.0/lxgwwenkaiscreenr.css"},"english":{"enable":true,"family":"","url":"https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;500;600;700&display=swap"}},"content_max_width":"1080px","sidebar_width":"240px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":false,"percentage":true},"website_counter":{"url":"https://cn.vercount.one/js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"preloader":true,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/cats.jpg","dark":"/images/cats.jpg"},"title":"xiangyu fu's blog","subtitle":{"text":["To Boldly Go Where No Man Has Gone Before","保持热爱，奔赴星海"],"hitokoto":{"enable":false,"api":"https://v1.hitokoto.cn"},"typing_speed":30,"backing_speed":40,"starting_delay":1000,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":false,"style":"default","links":{"github":null,"instagram":null,"zhihu":null,"twitter":null,"email":null},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":true},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null,"lrc":null}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.6.2","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"width":{"home":"1200px","pages":"1000px"},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Status":{"path":"https://status.ohevan.com/","icon":"fa-regular fa-chart-bar"},"tags":{"path":"/tags","icon":"fa-regular fa-tags"},"About":{"icon":"fa-regular fa-user","submenus":{"Me":"/about","Github":"https://github.com/Xiangyu-Fu","Blog":"https://xiangyu-fu.github.io/"}}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"cloud"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"show_on_mobile":true,"links":{"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Tags":{"path":"/tags","icon":"fa-regular fa-tags"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"}}},"article_date_format":"auto","categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":"2021/6/6 11:45:14"};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 7.2.0"></head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
<!--        <span class="swup-progress-icon">-->
<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
<!--        </span>-->
    
</div>


<main class="page-container" id="swup">

    

    <div class="main-content-container">


        <div class="main-content-header">
            <header class="navbar-container px-6 md:px-12">

    <div class="navbar-content ">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="/images/giphy.gif">
                </a>
            
            <a class="logo-title" href="/">
                
                xiangyu fu&#39;s blog
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/"
                                        >
                                    <i class="fa-regular fa-house fa-fw"></i>
                                    HOME
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/archives"
                                        >
                                    <i class="fa-regular fa-archive fa-fw"></i>
                                    ARCHIVES
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   target="_blank" rel="noopener" href="https://status.ohevan.com/"
                                        >
                                    <i class="fa-regular fa-chart-bar fa-fw"></i>
                                    STATUS
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/tags"
                                        >
                                    <i class="fa-regular fa-tags fa-fw"></i>
                                    TAGS
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown"
                                   href="#"
                                        onClick=&#34;return false;&#34;>
                                    <i class="fa-regular fa-user fa-fw"></i>
                                    ABOUT
                                    <i class="fa-solid fa-chevron-down fa-fw"></i>
                                </a>

                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                        
                                            <li>
                                                <a href="/about">
                                                    ME
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://github.com/Xiangyu-Fu">
                                                    GITHUB
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a href="https://xiangyu-fu.github.io/">
                                                    BLOG
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i>
                    </div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile sheet -->
    <div class="navbar-drawer h-screen w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/"
                        >
                            <span>
                                HOME
                            </span>
                            
                                <i class="fa-regular fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/archives"
                        >
                            <span>
                                ARCHIVES
                            </span>
                            
                                <i class="fa-regular fa-archive fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           target="_blank" rel="noopener" href="https://status.ohevan.com/"
                        >
                            <span>
                                STATUS
                            </span>
                            
                                <i class="fa-regular fa-chart-bar fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/tags"
                        >
                            <span>
                                TAGS
                            </span>
                            
                                <i class="fa-regular fa-tags fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item-sub text-base my-1.5 flex flex-col w-full">
                        
                        <div class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary cursor-pointer text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                             navbar-data-toggle="submenu-About"
                        >
                            <span>
                                ABOUT
                            </span>
                            
                                <i class="fa-solid fa-chevron-right fa-sm fa-fw transition-all"></i>
                            
                        </div>
                        

                        
                            <div class="flex-col items-start px-2 py-2 hidden" data-target="submenu-About">
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           href="/about">ME</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://github.com/Xiangyu-Fu">GITHUB</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           href="https://xiangyu-fu.github.io/">BLOG</a>
                                    </div>
                                
                            </div>
                        
                    </li>
            

            
            
                
                    
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/tags"
                        >
                            <span>Tags</span>
                            <i class="fa-regular fa-tags fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/categories"
                        >
                            <span>Categories</span>
                            <i class="fa-regular fa-folder fa-sm fa-fw"></i>
                        </a>
                    </li>
                
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">20</div>
        <div class="label text-third-text-color text-sm">Tags</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">0</div>
        <div class="label text-third-text-color text-sm">Categories</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">24</div>
        <div class="label text-third-text-color text-sm">Posts</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="post-page-container flex relative justify-between box-border w-full h-full">
    <div class="article-content-container">

        <div class="article-title relative w-full">
            
                <div class="w-full flex items-center pt-6 justify-start">
                    <h1 class="article-title-regular text-second-text-color text-4xl md:text-6xl font-bold px-2 sm:px-6 md:px-8 py-3">How to use UDP and mDNS on ESP32</h1>
                </div>
            
            </div>

        
            <div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
                <div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
                    <img src="/images/logo_Stan.png">
                </div>
                <div class="info flex flex-col justify-between">
                    <div class="author flex items-center">
                        <span class="name text-default-text-color text-lg font-semibold">xiangyu fu</span>
                        
                            <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv3</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2024-09-10 20:53:47</span>
        <span class="mobile">2024-09-10 20:53:47</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2024-09-10 20:55:34</span>
            <span class="mobile">2024-09-10 20:55:34</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/en-US/">en-US</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/ESP32/">ESP32</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/UDP/">UDP</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/mDNS/">mDNS</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>2k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>12 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        


        <div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
            <h3 id="introduction">Introduction</h3>
<p>In this tutorial, I will walk through using UDP and mDNS with the
ESP32 platform. I'll cover how to set up UDP communication between an
ESP32 and a client device, along with using mDNS to allow the client to
discover the ESP32 on the network without needing to know its IP
address. The code provided will demonstrate how to send data between the
ESP32 and a client, handle heartbeats, and ensure the client can
reconnect if communication is lost.</p>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>Basic knowledge of ESP32 and its Wi-Fi capabilities.</li>
<li>Familiarity with Arduino IDE or PlatformIO for ESP32
development.</li>
<li>Understanding of network communication concepts such as UDP and
mDNS.</li>
</ul>
<h3 id="what-is-udp-and-mdns">What is UDP and mDNS?</h3>
<p><strong>UDP (User Datagram Protocol)</strong> is a communication
protocol that allows devices to exchange messages over a network. It's a
connectionless protocol, meaning data is sent without establishing a
dedicated connection, which makes it faster but less reliable than
TCP.</p>
<p><strong>mDNS (Multicast DNS)</strong> allows devices on a local
network to discover each other without the need for a central DNS
server. It’s very useful for local network services, as it enables
devices to advertise their presence and be discovered by name (like
<code>smart_knob.local</code> in our case).</p>
<h3 id="setting-up-the-esp32-as-a-udp-server-with-mdns">Setting up the
ESP32 as a UDP Server with mDNS</h3>
<p>First, we set up the ESP32 to connect to Wi-Fi, initialize an mDNS
service, and create a UDP server to handle communication.</p>
<p>Here’s the core setup code for the ESP32:</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">WifiTask::run</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="built_in">setupWiFi</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// MDNS</span></span><br><span class="line">  <span class="keyword">if</span> (!MDNS.<span class="built_in">begin</span>(<span class="string">&quot;smart_knob&quot;</span>)) &#123;</span><br><span class="line">    <span class="built_in">ESP_LOGI</span>(TAG, <span class="string">&quot;mDNS failed to start&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">ESP_LOGI</span>(TAG, <span class="string">&quot;mDNS started successfully, device name is smart_knob.local&quot;</span>);</span><br><span class="line">  MDNS.<span class="built_in">addService</span>(udpServiceName, <span class="string">&quot;udp&quot;</span>, localUdpPort);</span><br><span class="line"></span><br><span class="line">  udp.<span class="built_in">begin</span>(localUdpPort);</span><br><span class="line">  heartbeatUdp.<span class="built_in">begin</span>(heartbeatPort);</span><br><span class="line">  tcpServer.<span class="built_in">begin</span>();</span><br><span class="line">  <span class="built_in">ESP_LOGI</span>(TAG, <span class="string">&quot;UDP service started, port number: %d&quot;</span>, localUdpPort);</span><br><span class="line">  <span class="built_in">ESP_LOGI</span>(TAG, <span class="string">&quot;Heartbeat service started, port number: %d&quot;</span>, heartbeatPort);</span><br><span class="line">  <span class="built_in">ESP_LOGI</span>(TAG, <span class="string">&quot;TCP service started, waiting for IP configuration, port number: %d&quot;</span>, <span class="number">4321</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>In this block of code:</p>
<ol type="1">
<li>The <code>setupWiFi()</code> function connects the ESP32 to the
Wi-Fi network.</li>
<li>mDNS is initialized with the name <code>smart_knob.local</code>
using <code>MDNS.begin()</code>. This allows the ESP32 to be discovered
on the network without needing its IP address.</li>
<li>UDP services for data transmission (<code>localUdpPort</code>) and
heartbeat monitoring (<code>heartbeatPort</code>) are started.</li>
<li>A TCP server is also initialized to receive the client’s IP
configuration.</li>
</ol>
<h3 id="handling-udp-heartbeats">Handling UDP Heartbeats</h3>
<p>The heartbeat mechanism ensures that communication between the client
and ESP32 is kept alive. If the ESP32 doesn’t receive a heartbeat within
the specified timeout period, it assumes the client has
disconnected.</p>
<div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> packetSize = heartbeatUdp.<span class="built_in">parsePacket</span>();</span><br><span class="line"><span class="keyword">if</span> (packetSize) &#123;</span><br><span class="line">  <span class="type">char</span> incomingPacket[<span class="number">255</span>];</span><br><span class="line">  <span class="type">int</span> len = heartbeatUdp.<span class="built_in">read</span>(incomingPacket, <span class="number">255</span>);</span><br><span class="line">  <span class="keyword">if</span> (len &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    incomingPacket[len] = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  String message = <span class="built_in">String</span>(incomingPacket);</span><br><span class="line">  <span class="keyword">if</span> (message == <span class="string">&quot;heartbeat&quot;</span>) &#123;</span><br><span class="line">    lastHeartbeat = <span class="built_in">millis</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>This code block listens for incoming heartbeat messages and resets
the timer whenever it receives the expected <code>heartbeat</code>
message.</p>
<h3 id="creating-a-client-in-python">Creating a Client in Python</h3>
<p>On the client side, I will use Python to send and receive UDP
messages and handle mDNS discovery.</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ESP32UDPClient</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.esp32_host = <span class="string">&#x27;smart_knob.local&#x27;</span>  <span class="comment"># ESP32 mDNS name or IP address</span></span><br><span class="line">        self.udp_port = <span class="number">1234</span></span><br><span class="line">        self.heartbeat_udp_port = <span class="number">1235</span></span><br><span class="line">        self.client_ip = <span class="string">&#x27;192.168.178.69&#x27;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Create UDP socket</span></span><br><span class="line">        self.client_udp_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line">        self.client_hearbeat_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Resolve mDNS name to IP address</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.esp32_ip = socket.gethostbyname(self.esp32_host)</span><br><span class="line">        <span class="keyword">except</span> socket.gaierror:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Bind the UDP socket to the client’s IP</span></span><br><span class="line">        self.client_udp_socket.bind((self.client_ip, self.udp_port))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Start sending heartbeats</span></span><br><span class="line">        self.heartbeat_thread = threading.Thread(target=self.send_heartbeat)</span><br><span class="line">        self.heartbeat_thread.daemon = <span class="literal">True</span></span><br><span class="line">        self.heartbeat_thread.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_heartbeat</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            message = <span class="string">&quot;heartbeat&quot;</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># Send heartbeat message to ESP32</span></span><br><span class="line">                self.client_hearbeat_socket.sendto(message.encode(), (self.esp32_ip, self.heartbeat_udp_port))</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            time.sleep(<span class="number">2</span>)</span><br></pre></td></tr></table></figure></div>
<p>This Python class allows the client to:</p>
<ol type="1">
<li>Use mDNS to resolve the ESP32’s IP address.</li>
<li>Create a UDP connection to communicate with the ESP32.</li>
<li>Periodically send heartbeat messages to ensure the connection
remains active.</li>
</ol>
<h3 id="conclusion">Conclusion</h3>
<p>In this project, I demonstrated how to use UDP and mDNS on the ESP32
for seamless communication with a client device. The ESP32 was set up as
a UDP server, handling both data transmission and heartbeat monitoring,
while the client communicated with it using Python.</p>
<p>This setup is highly efficient for local networks where devices need
to be discovered and communicate without requiring a central server or
hardcoded IP addresses.</p>
<h3 id="full-code">Full Code</h3>
<p>In this section, I provide the full code for the ESP32 and Python
client to implement the UDP and mDNS communication. For the ESP32 codes,
FreeRTOS is used to handle the tasks and queues for communication.</p>
<p><strong>wifi_task.h</strong> <div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Arduino.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;logger.h&quot;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;task.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WifiTask</span> : <span class="keyword">public</span> Task&lt;WifiTask&gt; &#123;</span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">class</span> <span class="title class_">Task</span>&lt;WifiTask&gt;; <span class="comment">// Allow base Task to invoke protected run()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">WifiTask</span>(<span class="type">const</span> <span class="type">uint8_t</span> task_core);</span><br><span class="line">    ~<span class="built_in">WifiTask</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addListener</span><span class="params">(QueueHandle_t queue)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setLogger</span><span class="params">(Logger* logger)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">publish</span><span class="params">(<span class="type">const</span> PB_SmartKnobConfig &amp; config)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendData</span><span class="params">(String data)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// QueueHandle_t uart_queue_;</span></span><br><span class="line">    Logger* logger_;</span><br><span class="line">    std::vector&lt;QueueHandle_t&gt; listeners_;</span><br><span class="line">    PB_SmartKnobConfig wifiConfig;</span><br><span class="line">    <span class="type">static</span> WifiTask* instance;</span><br><span class="line">    <span class="type">bool</span> isUDPConnected = <span class="literal">false</span>;</span><br><span class="line">    <span class="type">bool</span> isUDPReconnected = <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">loop</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setupWiFi</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">CommandCallback</span><span class="params">(<span class="type">const</span> knob_robot_control::KnobCommand&amp; msg)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div></p>
<p><strong>wifi_task.cpp</strong> <div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;wifi_task.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;WiFi.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ESPmDNS.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;WiFiUdp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_log.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *TAG = <span class="string">&quot;WIFI_TASK&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>*  ssid = <span class="string">&quot;YOUR_SSID&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>*  password = <span class="string">&quot;YOUR_PASSWORD&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Static member initialization</span></span><br><span class="line">WifiTask* WifiTask::instance = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">WiFiUDP udp;</span><br><span class="line">WiFiUDP heartbeatUdp;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> localUdpPort = <span class="number">1234</span>;</span><br><span class="line"><span class="type">char</span> incomingPacket[<span class="number">255</span>];       </span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *udpServiceName = <span class="string">&quot;esp32&quot;</span>;  </span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> heartbeatPort = <span class="number">1235</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TCP settings</span></span><br><span class="line"><span class="function">WiFiServer <span class="title">tcpServer</span><span class="params">(<span class="number">4321</span>)</span></span>;  <span class="comment">// ESP32 TCP port</span></span><br><span class="line">String clientIp = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Heartbeat settings</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> lastHeartbeat = <span class="number">0</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">long</span> heartbeatTimeout = <span class="number">5000</span>;  <span class="comment">// 5 seconds</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Force feedback</span></span><br><span class="line"><span class="type">float</span> tcp_force = <span class="number">1.0</span>;</span><br><span class="line"></span><br><span class="line">WifiTask::<span class="built_in">WifiTask</span>(<span class="type">const</span> <span class="type">uint8_t</span> task_core) : <span class="built_in">Task</span>(<span class="string">&quot;WIFI Task&quot;</span>, <span class="number">8192</span>, <span class="number">0</span>, task_core) &#123;</span><br><span class="line">    <span class="comment">// wifi_queue_ = xQueueCreate(1, sizeof(WifiConfig));</span></span><br><span class="line">    instance = <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">WifiTask::~<span class="built_in">WifiTask</span>() &#123;</span><br><span class="line">    <span class="comment">// Destructor code here</span></span><br><span class="line">    instance = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">WifiTask::addListener</span><span class="params">(QueueHandle_t queue)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">ESP_LOGI</span>(TAG, <span class="string">&quot;Add listener&quot;</span>);</span><br><span class="line">    listeners_.<span class="built_in">push_back</span>(queue);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">WifiTask::setLogger</span><span class="params">(Logger* logger)</span> </span>&#123;</span><br><span class="line">    logger_ = logger;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// publish is used for the logger</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">WifiTask::publish</span><span class="params">(<span class="type">const</span> PB_SmartKnobConfig &amp; config)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> listener : listeners_) &#123;</span><br><span class="line">        <span class="built_in">xQueueOverwrite</span>(listener, &amp;config); <span class="comment">// xQueueOverwrite will overwrite the queue if it is full</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">WifiTask::run</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="built_in">setupWiFi</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// MDNS</span></span><br><span class="line">  <span class="keyword">if</span> (!MDNS.<span class="built_in">begin</span>(<span class="string">&quot;esp32&quot;</span>)) &#123;</span><br><span class="line">    <span class="built_in">ESP_LOGI</span>(TAG, <span class="string">&quot;mDNS failed to start&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">ESP_LOGI</span>(TAG, <span class="string">&quot;mDNS started successfully, device name is esp32.local&quot;</span>);</span><br><span class="line">  MDNS.<span class="built_in">addService</span>(udpServiceName, <span class="string">&quot;udp&quot;</span>, localUdpPort);</span><br><span class="line"></span><br><span class="line">  udp.<span class="built_in">begin</span>(localUdpPort);</span><br><span class="line">  heartbeatUdp.<span class="built_in">begin</span>(heartbeatPort);</span><br><span class="line">  tcpServer.<span class="built_in">begin</span>();</span><br><span class="line">  <span class="built_in">ESP_LOGI</span>(TAG, <span class="string">&quot;UDP service started, port number: %d&quot;</span>, localUdpPort);</span><br><span class="line">  <span class="built_in">ESP_LOGI</span>(TAG, <span class="string">&quot;Heartbeat service started, port number: %d&quot;</span>, heartbeatPort);</span><br><span class="line">  <span class="built_in">ESP_LOGI</span>(TAG, <span class="string">&quot;TCP service started, waiting for IP configuration, port number: %d&quot;</span>, <span class="number">4321</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">    <span class="comment">// Check if we have received the client&#x27;s IP over TCP</span></span><br><span class="line">    <span class="keyword">if</span> (clientIp == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">      WiFiClient tcpClient = tcpServer.<span class="built_in">available</span>();</span><br><span class="line">      <span class="keyword">if</span>(isUDPReconnected)&#123;</span><br><span class="line">        Serial.<span class="built_in">print</span>(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">        <span class="built_in">vTaskDelay</span>(<span class="number">1000</span> / portTICK_PERIOD_MS);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (tcpClient) &#123;</span><br><span class="line">        <span class="built_in">ESP_LOGI</span>(TAG, <span class="string">&quot;Client connected via TCP.&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (tcpClient.<span class="built_in">connected</span>() &amp;&amp; tcpClient.<span class="built_in">available</span>() == <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="built_in">delay</span>(<span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (tcpClient.<span class="built_in">available</span>()) &#123;</span><br><span class="line">          clientIp = tcpClient.<span class="built_in">readString</span>();</span><br><span class="line">          <span class="built_in">ESP_LOGI</span>(TAG, <span class="string">&quot;Received client IP: %s&quot;</span>, clientIp.<span class="built_in">c_str</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        isUDPConnected = <span class="literal">true</span>;</span><br><span class="line">        isUDPReconnected = <span class="literal">true</span>;</span><br><span class="line">        tcpClient.<span class="built_in">stop</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// Check for UDP heartbeat</span></span><br><span class="line">      <span class="type">int</span> packetSize = heartbeatUdp.<span class="built_in">parsePacket</span>();</span><br><span class="line">      <span class="keyword">if</span> (packetSize) &#123;</span><br><span class="line">        <span class="type">char</span> incomingPacket[<span class="number">255</span>];</span><br><span class="line">        <span class="type">int</span> len = heartbeatUdp.<span class="built_in">read</span>(incomingPacket, <span class="number">255</span>);</span><br><span class="line">        <span class="keyword">if</span> (len &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          incomingPacket[len] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String message = <span class="built_in">String</span>(incomingPacket);</span><br><span class="line">        <span class="keyword">if</span> (message == <span class="string">&quot;heartbeat&quot;</span>) &#123;</span><br><span class="line">          lastHeartbeat = <span class="built_in">millis</span>();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Check heartbeat timeout</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">millis</span>() - lastHeartbeat &gt; heartbeatTimeout) &#123;</span><br><span class="line">        <span class="built_in">ESP_LOGW</span>(TAG, <span class="string">&quot;No heartbeat received, stopping communication.&quot;</span>);</span><br><span class="line">        <span class="built_in">ESP_LOGW</span>(TAG, <span class="string">&quot;Waiting for client to reconnect.&quot;</span>);</span><br><span class="line">        clientIp = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        isUDPConnected = <span class="literal">false</span>;</span><br><span class="line">        tcpServer.<span class="built_in">begin</span>();</span><br><span class="line">      &#125; </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">WifiTask::sendData</span><span class="params">(String data)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (isUDPConnected)</span><br><span class="line">  &#123;</span><br><span class="line">    udp.<span class="built_in">beginPacket</span>(clientIp.<span class="built_in">c_str</span>(), localUdpPort);</span><br><span class="line">    udp.<span class="built_in">print</span>(data.<span class="built_in">c_str</span>());</span><br><span class="line">    udp.<span class="built_in">endPacket</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">WifiTask::setupWiFi</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="built_in">ESP_LOGI</span>(TAG, <span class="string">&quot;Connecting to WiFi&quot;</span>);</span><br><span class="line">    WiFi.<span class="built_in">begin</span>(ssid, password);</span><br><span class="line">    <span class="keyword">while</span> (WiFi.<span class="built_in">status</span>() != WL_CONNECTED) &#123; <span class="built_in">delay</span>(<span class="number">500</span>);Serial.<span class="built_in">print</span>(<span class="string">&quot;.&quot;</span>); &#125;</span><br><span class="line">    <span class="built_in">ESP_LOGI</span>(TAG, <span class="string">&quot;Connected to WiFi %s&quot;</span>, ssid);</span><br><span class="line">    <span class="built_in">ESP_LOGI</span>(TAG, <span class="string">&quot;IP: %s&quot;</span>, WiFi.<span class="built_in">localIP</span>().<span class="built_in">toString</span>().<span class="built_in">c_str</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p>
<p>Here is the Python client code:</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># import rospy</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="comment"># from std_msgs.msg import String</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ESP32UDPClient</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.esp32_host = <span class="string">&#x27;esp32.local&#x27;</span>  <span class="comment"># ESP32 mDNS name or IP address</span></span><br><span class="line">        self.udp_port = <span class="number">1234</span>              <span class="comment"># ESP32 UDP port</span></span><br><span class="line">        self.heartbeat_udp_port = <span class="number">1235</span></span><br><span class="line">        self.esp32_tcp_port = <span class="number">4321</span>       <span class="comment"># ESP32 TCP port</span></span><br><span class="line">        self.heartbeat_interval = <span class="number">2</span>      <span class="comment"># Heartbeat message interval</span></span><br><span class="line">        self.client_ip = <span class="string">&#x27;192.168.178.69&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Create UDP and TCP sockets</span></span><br><span class="line">        self.client_udp_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line">        self.client_hearbeat_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line">        self.client_tcp_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Resolve mDNS name to IP address</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.esp32_ip = socket.gethostbyname(self.esp32_host)</span><br><span class="line">        <span class="keyword">except</span> socket.gaierror:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Set socket timeout</span></span><br><span class="line">        self.client_udp_socket.settimeout(<span class="number">5</span>)</span><br><span class="line">        self.client_hearbeat_socket.settimeout(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Bind UDP socket to client IP address</span></span><br><span class="line">        self.client_udp_socket.bind((self.client_ip, self.udp_port))  </span><br><span class="line"></span><br><span class="line">        <span class="comment"># Start threads</span></span><br><span class="line">        self.receive_thread = threading.Thread(target=self.receive_udp_messages)</span><br><span class="line">        self.receive_thread.daemon = <span class="literal">True</span></span><br><span class="line">        self.receive_thread.start()</span><br><span class="line"></span><br><span class="line">        self.heartbeat_thread = threading.Thread(target=self.send_heartbeat)</span><br><span class="line">        self.heartbeat_thread.daemon = <span class="literal">True</span></span><br><span class="line">        self.heartbeat_thread.start()</span><br><span class="line"></span><br><span class="line">        self.send_ip_configuration()</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_ip_configuration</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Send the client IP address to ESP32 over TCP.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># Connect to ESP32 TCP server</span></span><br><span class="line">            self.client_tcp_socket.connect((self.esp32_ip, self.esp32_tcp_port))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Send local IP address of this machine to ESP32</span></span><br><span class="line">            local_ip = self.client_ip</span><br><span class="line">            self.client_tcp_socket.sendall(local_ip.encode())</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Close TCP connection</span></span><br><span class="line">            self.client_tcp_socket.close()</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="comment"># rospy.logerr(f&quot;Error during TCP communication: &#123;e&#125;&quot;)</span></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request_callback</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="comment"># Callback function when a message is received on &#x27;esp32_request&#x27; topic</span></span><br><span class="line">        self.send_udp_message(msg.data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_udp_message</span>(<span class="params">self, message</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># Send UDP packet to ESP32</span></span><br><span class="line">            self.client_udp_socket.sendto(message.encode(), (self.esp32_ip, self.udp_port))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="comment"># rospy.logerr(f&quot;Error sending UDP message: &#123;e&#125;&quot;)</span></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_heartbeat</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Send heartbeat messages periodically to the ESP32.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># while not rospy.is_shutdown():</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            message = <span class="string">&quot;heartbeat&quot;</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># Send heartbeat message to ESP32</span></span><br><span class="line">                self.client_hearbeat_socket.sendto(message.encode(), (self.esp32_ip, self.heartbeat_udp_port))</span><br><span class="line"></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            time.sleep(self.heartbeat_interval)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">receive_udp_messages</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># while not rospy.is_shutdown():</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># Receive data from ESP32</span></span><br><span class="line">                data, addr = self.client_udp_socket.recvfrom(<span class="number">1024</span>)</span><br><span class="line">                response = data.decode()</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Received response from <span class="subst">&#123;addr&#125;</span>: <span class="subst">&#123;response&#125;</span>&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># Publish the response to a ROS topic</span></span><br><span class="line">                self.pub.publish(response)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">except</span> socket.timeout:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Timeout occurred, no data received.&quot;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        client = ESP32UDPClient()</span><br><span class="line">        client.run()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>I also provide a simple mDNS service discovery code in Python to
discover the ESP32 device on the network:</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://github.com/python-zeroconf/python-zeroconf</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> zeroconf <span class="keyword">import</span> ZeroconfServiceTypes, ServiceBrowser, ServiceListener, Zeroconf</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyListener</span>(<span class="title class_ inherited__">ServiceListener</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_service</span>(<span class="params">self, zc: Zeroconf, type_: <span class="built_in">str</span>, name: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Service <span class="subst">&#123;name&#125;</span> updated&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">remove_service</span>(<span class="params">self, zc: Zeroconf, type_: <span class="built_in">str</span>, name: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Service <span class="subst">&#123;name&#125;</span> removed&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_service</span>(<span class="params">self, zc: Zeroconf, type_: <span class="built_in">str</span>, name: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        info = zc.get_service_info(type_, name)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Service <span class="subst">&#123;name&#125;</span> added, service info: <span class="subst">&#123;info&#125;</span>&quot;</span>)</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">zeroconf = Zeroconf()</span><br><span class="line">listener = MyListener()</span><br><span class="line">browser = ServiceBrowser(zeroconf, <span class="string">&quot;_netx._tcp.local.&quot;</span>, listener)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;press enter to exit...\n&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>.join(ZeroconfServiceTypes.find()))</span><br><span class="line">    <span class="built_in">input</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    zeroconf.close()</span><br></pre></td></tr></table></figure></div>
<p>Happy coding! 🚀</p>

        </div>

        
            <div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8">
                <div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> How to use UDP and mDNS on ESP32</li>
        <li><strong>Author:</strong> xiangyu fu</li>
        <li><strong>Created at
                :</strong> 2024-09-10 20:53:47</li>
        
            <li>
                <strong>Updated at
                    :</strong> 2024-09-10 20:55:34
            </li>
        
        <li>
            <strong>Link:</strong> https://redefine.ohevan.com/2024/09/10/Reviews/esp32_udp/
        </li>
        <li>
            <strong>
                License:
            </strong>
            

            
                This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.
            
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden">
                
                    <li class="tag-item mx-0.5">
                        <a href="/tags/en-US/">#en-US</a>&nbsp;
                    </li>
                
                    <li class="tag-item mx-0.5">
                        <a href="/tags/ESP32/">#ESP32</a>&nbsp;
                    </li>
                
                    <li class="tag-item mx-0.5">
                        <a href="/tags/UDP/">#UDP</a>&nbsp;
                    </li>
                
                    <li class="tag-item mx-0.5">
                        <a href="/tags/mDNS/">#mDNS</a>&nbsp;
                    </li>
                
            </ul>
        

        

        
            <div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
                
                    <div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="prev"
                        rel="prev"
                        href="/2024/11/26/Reviews/tdmpc_fowm/"
                        >
                            <span class="left arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-left"></i>
                            </span>
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">Review of TD-MPC and FOWM</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="next"
                        rel="next"
                        href="/2024/08/30/Reviews/local_dhcp/"
                        >
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">How to conect an Ubuntu system to a hardware device using DHCP</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        


        
            <div class="comment-container px-2 sm:px-6 md:px-8 pb-8">
                <div class="comments-container mt-10 w-full ">
    <div id="comment-anchor" class="w-full h-2.5"></div>
    <div class="comment-area-title w-full my-1.5 md:my-2.5 text-xl md:text-3xl font-bold">
        Comments
    </div>
    

        
            
    <div id="waline"></div>
    <script type="module" data-swup-reload-script>
      import { init } from '/js/libs/waline.mjs';

      function loadWaline() {
        init({
          el: '#waline',
          serverURL: 'https://example.example.com',
          lang: 'en-US',
          dark: 'body[class~="dark-mode"]',
          requiredMeta: ['nick', 'mail'],
          emoji: [],
          recaptchaV3Key: "wasd",
          
        });
      }

      if (typeof swup !== 'undefined') {
        loadWaline();
      } else {
        window.addEventListener('DOMContentLoaded', loadWaline);
      }
    </script>



        
    
</div>

            </div>
        
    </div>

    
        <div class="toc-content-container">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">On this page</div>
        <div class="page-title">How to use UDP and mDNS on ESP32</div>
        <ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#introduction"><span class="nav-text">Introduction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#prerequisites"><span class="nav-text">Prerequisites</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#what-is-udp-and-mdns"><span class="nav-text">What is UDP and mDNS?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#setting-up-the-esp32-as-a-udp-server-with-mdns"><span class="nav-text">Setting up the
ESP32 as a UDP Server with mDNS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#handling-udp-heartbeats"><span class="nav-text">Handling UDP Heartbeats</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#creating-a-client-in-python"><span class="nav-text">Creating a Client in Python</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#conclusion"><span class="nav-text">Conclusion</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#full-code"><span class="nav-text">Full Code</span></a></li></ol>

    </div>
</div>
        </div>
    
</div>



                

            </div>

            

        </div>

        <div class="main-content-footer">
            <footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2021</span>
              -
            
            2024&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">xiangyu fu</a>
            
                
                <p class="post-count space-x-0.5">
                    <span>
                        24 posts in total
                    </span>
                    
                        <span>
                            72.2k words in total
                        </span>
                    
                </p>
            
        </div>
        
            <script data-swup-reload-script src="https://cn.vercount.one/js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">VISITOR COUNT</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">TOTAL PAGE VIEWS</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.6.2</a></span>
        </div>
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fa-regular fa-comments"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fa-solid fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fa-solid fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>


    
<script src="/js/libs/Swup.min.js"></script>

<script src="/js/libs/SwupSlideTheme.min.js"></script>

<script src="/js/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>







<script src="/js/tools/imageViewer.js" type="module"></script>

<script src="/js/utils.js" type="module"></script>

<script src="/js/main.js" type="module"></script>

<script src="/js/layouts/navbarShrink.js" type="module"></script>

<script src="/js/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/layouts/categoryList.js" type="module"></script>



    
<script src="/js/tools/localSearch.js" type="module"></script>




    
<script src="/js/tools/codeBlock.js" type="module"></script>




    
<script src="/js/layouts/lazyload.js" type="module"></script>




    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js" type="module"></script>









<div class="post-scripts" data-swup-reload-script>
    
        
<script src="/js/tools/tocToggle.js" type="module"></script>

<script src="/js/layouts/toc.js" type="module"></script>

<script src="/js/plugins/tabs.js" type="module"></script>

    
</div>


</body>
</html>
